{% extends 'base.html' %}

{% block content %}
<div class="home-container">
    <!-- Navbar -->
    <!-- Navbar -->
    <nav class="navbar"
        style="position: absolute; top: 0; left: 0; right: 0; z-index: 1000; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; pointer-events: none;">

        <!-- Logo Area -->
        <a href="/" style="text-decoration: none; pointer-events: auto;">
            <div class="glass-pill"
                style="display: flex; gap: 0.75rem; align-items: center; background: rgba(17, 24, 39, 0.8); backdrop-filter: blur(12px); padding: 0.5rem 1rem; border-radius: 99px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 20px rgba(0,0,0,0.4);">
                <img src="{{ url_for('static', filename='img/Logo.png') }}" alt="Logo"
                    style="height: 36px; width: auto;">
                <span
                    style="color: white; font-weight: 700; font-size: 1rem; letter-spacing: -0.02em; display: none; @media(min-width: 400px){display: inline;}">ParkingSlot<span
                        style="color: #818cf8;">.</span></span>
            </div>
        </a>

        <!-- Right Side Controls -->
        <div style="display: flex; gap: 0.75rem; align-items: center; pointer-events: auto;">

            <!-- Wallet Badge -->
            <div class="glass-pill"
                style="background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3); padding: 0.5rem 1rem; border-radius: 99px; display: flex; align-items: center; gap: 0.6rem; backdrop-filter: blur(8px);">
                <div
                    style="background: #10b981; color: black; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem;">
                    <ion-icon name="wallet"></ion-icon>
                </div>
                <div style="display: flex; flex-direction: column; justify-content: center; line-height: 1.1;">
                    <span
                        style="font-size: 0.6rem; color: #6ee7b7; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase;">BALANCE</span>
                    <span
                        style="font-weight: 800; color: white; font-size: 0.95rem; font-variant-numeric: tabular-nums;"
                        id="userWallet">GH₵ 0.00</span>
                </div>
            </div>

            <!-- Profile / Dashboard Link -->
            <a href="/dashboard" class="glass-pill"
                style="background: white; color: black; padding: 0.5rem 0.5rem 0.5rem 1rem; border-radius: 99px; display: flex; align-items: center; gap: 0.5rem; text-decoration: none; font-weight: 700; font-size: 0.9rem; box-shadow: 0 0 20px rgba(255,255,255,0.2);">
                <span style="display: none; @media(min-width: 480px){display: inline;}">My Account</span>
                <div
                    style="width: 32px; height: 32px; background: #000; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <ion-icon name="person"></ion-icon>
                </div>
            </a>
        </div>
    </nav>

    <!-- Map -->
    <div id="map" class="map-bg"></div>

    <!-- Cinematic Gradients -->
    <div
        style="position: absolute; top: 0; left: 0; right: 0; height: 12rem; background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%); pointer-events: none; z-index: 5;">
    </div>
    <div
        style="position: absolute; bottom: 0; left: 0; right: 0; height: 12rem; background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%); pointer-events: none; z-index: 5;">
    </div>

    <!-- Search -->
    <div class="search-container">
        <div class="search-box">
            <div class="search-input-wrapper">
                <ion-icon name="search" style="color: #9ca3af; font-size: 1.25rem;"></ion-icon>
                <input type="text" id="searchInput" class="search-input" placeholder="Search or say 'Find Bike'...">
                <button onclick="startVoiceSearch()" id="voiceBtn"
                    style="background: none; border: none; color: #6366f1; display: flex; cursor: pointer; transition: transform 0.2s;">
                    <ion-icon name="mic" style="font-size: 1.2rem;"></ion-icon>
                </button>
            </div>
            <div style="display: flex; gap: 0.5rem; overflow-x: auto; margin-top: 0.75rem; padding-bottom: 0.25rem;"
                class="no-scrollbar">
                <button class="filter-chip" data-val="All"
                    style="padding: 4px 12px; border-radius: 99px; background: rgba(99,102,241,0.2); border: 1px solid #6366f1; color: white; font-size: 0.75rem;">All</button>
                <button class="filter-chip" data-val="Nearby"
                    style="padding: 4px 12px; border-radius: 99px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #9ca3af; font-size: 0.75rem;">Nearby</button>
                <button class="filter-chip" data-val="Cheap"
                    style="padding: 4px 12px; border-radius: 99px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #9ca3af; font-size: 0.75rem;">Lowest
                    Price</button>
                <button class="filter-chip" data-val="Bike"
                    style="padding: 4px 12px; border-radius: 99px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #9ca3af; font-size: 0.75rem;">Bikes</button>
                <button class="filter-chip" data-val="Truck"
                    style="padding: 4px 12px; border-radius: 99px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #9ca3af; font-size: 0.75rem;">Trucks</button>
            </div>
        </div>
    </div>

    <!-- Nav Controls -->
    <div id="navControls" class="nav-controls">
        <div class="nav-info-card">
            <div>
                <div style="font-size: 0.75rem; color: #9ca3af; margin-bottom: 0.25rem;">Navigate to</div>
                <div id="navTargetName" style="font-weight: 700; font-size: 1.1rem;">Target</div>
                <div id="navDistance" style="font-size: 0.875rem; color: #6366f1;">Calculating...</div>
            </div>
            <button onclick="stopNavigation()" class="btn-icon-only btn-danger-soft">
                <ion-icon name="close"></ion-icon>
            </button>
        </div>
    </div>

    <!-- Spot Slider -->
    <div class="spots-slider" id="spotsList">
        <!-- Rendered via JS -->
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal-overlay hidden">
        <div class="glass-card" style="width: 100%; max-width: 320px; background: #030712;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                <h3 style="font-weight: 700; font-size: 1.1rem;">Confirm Booking</h3>
                <button onclick="closeBookingModal()"
                    style="background: none; border: none; color: white; font-size: 1.5rem;"><ion-icon
                        name="close"></ion-icon></button>
            </div>
            <form id="bookingForm" style="display: flex; flex-direction: column; gap: 0.75rem;">
                <input type="hidden" name="spot_id" id="bookingSpotId">
                <div>
                    <label style="display: block; color: #9ca3af; font-size: 0.75rem; margin-bottom: 0.25rem;">Your
                        Name</label>
                    <input type="text" name="user_name" class="input-glass" placeholder="e.g. Ama Mensah" required>
                </div>
                <div>
                    <label style="display: block; color: #9ca3af; font-size: 0.75rem; margin-bottom: 0.25rem;">Phone
                        Number</label>
                    <input type="tel" name="user_phone" class="input-glass" placeholder="024 123 4567" required>
                </div>
                <div>
                    <label style="display: block; color: #9ca3af; font-size: 0.75rem; margin-bottom: 0.25rem;">Vehicle
                        Plate</label>
                    <input type="text" name="vehicle_plate" class="input-glass" placeholder="GW-2024-24" required>
                </div>
                <div>
                    <label
                        style="display: block; color: #9ca3af; font-size: 0.75rem; margin-bottom: 0.25rem;">Duration</label>
                    <select name="duration_select" id="bookingDuration" class="input-glass"
                        onchange="toggleCustomDuration()">
                        <option value="1">1 Hour</option>
                        <option value="2">2 Hours</option>
                        <option value="3">3 Hours</option>
                        <option value="4">4 Hours</option>
                        <option value="8">8 Hours (Work Day)</option>
                        <option value="custom">Custom...</option>
                    </select>
                    <input type="number" name="custom_duration" id="customDurationInput" class="input-glass hidden"
                        placeholder="Enter hours..." min="1" max="24" style="margin-top: 0.5rem;"
                        oninput="updateBookingPrice()">
                </div>
                <div
                    style="background: rgba(99,102,241,0.1); padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.5rem;">
                    <div
                        style="display: flex; justify-content: space-between; font-size: 0.875rem; margin-bottom: 0.25rem;">
                        <span style="color: #9ca3af;">Total to Pay</span>
                        <span style="font-weight: 700; color: #fbbf24; font-size: 1.1rem;" id="bookingPrice">GH₵
                            0.00</span>
                    </div>
                </div>
                <button type="submit" class="btn-primary" style="justify-content: center; margin-top: 0.5rem;">Confirm
                    Reservation</button>
            </form>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal-overlay hidden">
        <div class="glass-card" style="width: 100%; max-width: 320px; background: #030712; text-align: center;">
            <div
                style="width: 48px; height: 48px; background: rgba(255, 206, 86, 0.2); color: #fbbf24; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem auto;">
                <ion-icon name="wallet" style="font-size: 24px;"></ion-icon>
            </div>
            <h3 style="font-weight: 700; font-size: 1.25rem; margin-bottom: 0.5rem;">Payment Required</h3>
            <p style="color: #9ca3af; font-size: 0.875rem; margin-bottom: 1.5rem;">To finalize your spot, please send <b
                    style="color: white;" id="payAmount">GH₵ 0</b> to:</p>

            <div
                style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1.5rem; text-align: left;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span style="color: #9ca3af; font-size: 0.8rem;">Name</span>
                    <span style="font-weight: 600;">Spark Dzakpasu</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span style="color: #9ca3af; font-size: 0.8rem;">Number</span>
                    <span style="font-weight: 600; color: #fbbf24;">0551389510</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: #9ca3af; font-size: 0.8rem;">Reference</span>
                    <span style="font-weight: 600; font-family: monospace;" id="payRef">PARK-001</span>
                </div>
            </div>

            <button onclick="finishPayment()" class="btn-primary" style="width: 100%; justify-content: center;">I Have
                Sent the Money</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
    window.PAYSTACK_PUBLIC_KEY = "{{ paystack_key }}";
    window.USER_EMAIL = "guest@example.com"; // Default email, can be updated dynamically
</script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}